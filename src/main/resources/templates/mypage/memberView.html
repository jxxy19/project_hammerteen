<!DOCTYPE html>

<html
        class="light-style layout-menu-fixed layout-wide layout-navbar-fixed"
        lang="en"
        layout:decorate="~{/common/common.html}"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<body>
<!-- Layout wrapper -->
<th:block layout:fragment="content">
    <section>
        <div class="container">
            <div class="layout-wrapper layout-content-navbar">
                <div class="layout-container">
                    <div class="content-wrapper">
                        <div class="container-xxl flex-grow-1 container-p-y">
                            <div class="row">
                                <form id="frm" name="frm" action="/mypage/memberView" method="post" enctype="multipart/form-data">
                                    <input type="hidden" id="temFileName" name="temFileName" th:value="${dto.fileName != null ? dto.fileName : ''}" />

                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-sm-12 col-md-12 d-lg-flex mb-3 justify-content-between">
                                            <div class="d-lg-flex w-100 justify-content-start">
                                                <div class="row m-lg-0 pb-sm-1 pb-md-1">
                                                    <a class="col-sm-12 btn btn-outline-primary" href="/mypage/memberList">목록</a>
                                                </div>
                                            </div>
                                            <div class="d-lg-flex w-100 justify-content-end">
                                                <div class="row m-lg-0 pb-sm-1 pb-md-1 pe-lg-1">
                                                    <a class="col-sm-12 btn btn-outline-primary" type="submit" id="delete_button">탈퇴</a>
                                                </div>
                                                <div class="row m-lg-0 pb-sm-1 pb-md-1">
                                                    <button  type="submit" class="col-sm-12 btn btn-primary" id="submit_button">수정</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card mb-4">
                                        <h5 class="card-header">나의 계정 정보</h5>
                                        <!-- Account -->

                                            <input type="hidden" name="userState" id="userState" value="Y">
                                        <div class="card-body">
                                            <div class="d-flex align-items-start align-items-sm-center gap-4">
                                                <img
                                                        th:src="${dto.fileName != null ? '/upload/' + dto.fileName : '/assets/img/image/images2.jpeg'}"
                                                        alt="user-avatar"
                                                        class="d-block rounded"
                                                        height="100"
                                                        width="100"
                                                        id="uploadedAvatar" />
                                                <div class="button-wrapper">
                                                    <label for="upload" class="btn btn-primary me-2 mb-4" tabindex="0">
                                                        <span class="d-none d-sm-block">사진 올리기</span>
                                                        <i class="bx bx-upload d-block d-sm-none"></i>
                                                        <input
                                                                type="file"
                                                                id="upload"
                                                                name="file"
                                                                class="account-file-input"
                                                                hidden
                                                                accept="image/png, image/jpeg"
                                                                multiple/>
                                                    </label>
                                                    <button type="button" id="reset_button" class="btn btn-outline-secondary account-image-reset mb-4">
                                                        <i class="bx bx-reset d-block d-sm-none"></i>
                                                        <span class="d-none d-sm-block">초기화</span>
                                                    </button>

                                                    <p class="text-muted mb-0">800K사이즈의 JPG, GIF 또는 PNG만 업로드 가능합니다.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <hr class="my-0">
                                        <div class="card-body">
                                            <form id="formAccountSettings" method="POST" onsubmit="return false">
                                                <div class="row">
                                                    <div class="mb-3 col-md-12">
                                                        <label for="role" class="form-label">회원구분</label>
                                                        <select id="role" name="role" class="form-select">
                                                            <option th:value="user" th:selected="${dto.role == 'user'}">일반</option>
                                                            <option th:value="teacher" th:selected="${dto.role == 'teacher'}">선생님</option>
                                                            <option th:value="admin" th:selected="${dto.role == 'admin'}">관리자</option>
                                                        </select>
                                                    </div>
                                                    <div class="mb-3 col-md-6">
                                                        <label for="userId" class="form-label">ID</label>
                                                        <input class="form-control" type="text" name="userId" id="userId" th:value="${dto.userId}" readonly>
                                                    </div>
                                                    <div class="mb-3 col-md-6">
                                                        <label for="name" class="form-label">이름</label>
                                                        <input class="form-control" type="text" id="name" name="name" th:value="${dto.name}" readonly>
                                                    </div>
                                                    <div class="mb-3 col-md-6">
                                                        <label class="form-label" for="pwd">비밀번호</label>
                                                        <div class="input-group input-group-merge form-password-toggle">
                                                            <input type="password" id="pwd" class="form-control" name="pwd" placeholder="············" aria-describedby="password">
                                                            <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3 col-md-6">
                                                        <label class="form-label" for="confirm_pwd">비밀번호 재입력</label>
                                                        <div class="input-group input-group-merge form-password-toggle">
                                                            <input type="password" id="confirm_pwd" class="form-control" name="confirm_pwd" placeholder="············" aria-describedby="password">
                                                            <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3 col-md-6">
                                                        <label for="birthday" class="form-label">생일</label>
                                                        <input type="date" class="form-control" id="birthday" name="birthday" value="1960-03-05" th:value="${dto.birthday}" readonly>
                                                    </div>
                                                    <div class="mb-3 col-md-6">
                                                        <div class="row">
                                                            <div class="col-lg-8 col-sm-9 pe-lg-1">
                                                                <label for="email" class="form-label">이메일</label>
                                                                <input type="text" class="form-control" id="email" name="email" placeholder="abc@email.com" th:value="${dto.email}">
                                                            </div>
                                                            <div class="col-lg-4 col-sm-3 align-content-end ps-lg-1">
                                                                <button type="button" class="form-control btn btn-outline-primary" id="emailCheck" name="emailCheck">중복체크</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3 col-md-6">
                                                        <label for="phoneNumber" class="form-label">전화번호</label>
                                                        <div class="input-group">
                                                            <!-- Phone Number Prefix -->
                                                            <input class="form-control" type="text" id="phoneNumber" name="phoneNumber" th:value="${#strings.substring(session.memberDTO.phoneNumber, 0, 3)}" placeholder="010" style="width: 80px;" maxlength="3"/>
                                                            <!-- Separator -->
                                                            <span class="input-group-text">-</span>
                                                            <!-- Phone Number Middle -->
                                                            <input class="form-control" type="text" id="phoneNumber2" name="phoneNumber" th:value="${#strings.substring(session.memberDTO.phoneNumber, 3, 7)}" placeholder="1234" style="width: 100px;" maxlength="4" />
                                                            <!-- Separator -->
                                                            <span class="input-group-text">-</span>
                                                            <!-- Phone Number Suffix -->
                                                            <input class="form-control" type="text" id="phoneNumber3" name="phoneNumber" th:value="${#strings.substring(session.memberDTO.phoneNumber, 7, 11)}" placeholder="5678" style="width: 100px;" maxlength="4"/>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3 col-md-6">
                                                        <div class="row">
                                                            <div class="col-lg-8 col-sm-8 pe-lg-1 px-sm-2">
                                                                <label for="zipcode" class="form-label">우편번호</label>
                                                                <input type="text" class="form-control bg-white" id="zipCode" name="zipCode" placeholder="우편번호" readonly th:value="${dto.zipCode}">
                                                            </div>
                                                            <div class="col-lg-4 col-sm-4 align-content-end ps-lg-1">
                                                                <button type="button" class="form-control btn btn-outline-primary" id="zipCodeBtn" name="zipCodeBtn">우편번호</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row justify-content-end">
                                                    <div class="mb-3 col-md-6 ">
                                                        <label for="addr1" class="form-label">주소</label>
                                                        <input class="form-control bg-white" type="text" id="addr1" name="addr1" value="" placeholder="주소" th:value="${dto.addr1}" readonly>
                                                    </div>
                                                </div>
                                                <div class="row justify-content-end">
                                                    <div class="mb-3 col-md-6 ">
                                                        <label for="addr2" class="form-label">상세 주소</label>
                                                        <input class="form-control" type="text" id="addr2" name="addr2" value="" placeholder="상세주소" th:value="${dto.addr2}" >
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <!-- /Account -->

                                    </div>
                                </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Modal -->
</th:block>
<!-- build:js assets/vendor/js/core.js -->
<th:block layout:fragment="script">
    <script src="/assets/js/pages-account-settings-account.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script>
        let zipcode = document.getElementById("zipCode");
        let zipcodeBtn = document.getElementById("zipCodeBtn");
        let addr1 = document.getElementById("addr1");

        zipcodeBtn.addEventListener("click", ()=> {
            zipCode(zipcode, addr1);
        });


        //비밀번호 유효성
        const submit_button =document.querySelector("#submit_button");
        submit_button.addEventListener("click",function (e){
            e.preventDefault();
            const pwd= document.querySelector("#pwd");
            const confirm_pwd= document.querySelector("#confirm_pwd");


            //비밀번호 일치
            if(!passwordMatch(confirm_pwd,pwd)){
                alert("비밀번호가 일치하지 않습니다.");
                return false;
            }

            const confirm_msg ="정말로 수정하시겠습니까?";
            if(confirm(confirm_msg)){
                alert("정보가 수정되었습니다.");
                document.frm.submit();
            }


        });

        //파일업로드
        document.getElementById('upload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('uploadedAvatar').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        document.addEventListener("DOMContentLoaded", function() {
            // 콘솔에 로그 추가
            console.log("DOM fully loaded and parsed");

            // 이미지 리셋
            document.getElementById("reset_button").addEventListener("click", function() {
                // 콘솔에 로그 추가
                console.log("Reset button clicked");

                // 'upload' input 요소 선택
                const uploadInput = document.getElementById("upload");
                // input 요소의 값을 초기화
                uploadInput.value = "";

                // 'uploadedAvatar' id를 가진 img 요소 선택
                const uploadedAvatar = document.getElementById("uploadedAvatar");
                // img 요소의 src 속성을 기본 이미지 경로로 변경
                uploadedAvatar.src = '/assets/img/image/images2.jpeg';

                // 'temFileName' id를 가진 input 요소 선택
                const temFileNameInput = document.getElementById("temFileName");
                // input 요소의 값을 빈 문자열로 변경
                temFileNameInput.value = "";

                // 콘솔에 로그 추가
                console.log("Image source reset to default");
            });
        });

    //탈퇴
        const delete_button = document.querySelector("#delete_button");
        delete_button.addEventListener("click",function (e){
            e.preventDefault();
            const userId = document.querySelector("#userId").value;
            const confirm_msg = "이 회원을 정말로 탈퇴시키겠습니까?"
            if(confirm(confirm_msg)){
                alert("탈퇴되었습니다.")
                    location.href='/member/delete?userId='+userId;

            }

        });




    </script>

</th:block>
</body>
</html>
