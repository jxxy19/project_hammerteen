<!DOCTYPE html>

<html
  lang="en"
  class="light-style layout-menu-fixed layout-wide layout-navbar-fixed"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{/common/common.html}">
    <!-- Layout wrapper -->
    <th:block layout:fragment="content">
    <section class="section-py">
      <div class="container">
        <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
          <div class="content-wrapper">
            <!-- Content -->
            <div class="container-xxl flex-grow-1 container-p-y">
              <div class="row">
                <div class="col-md-12">
                  <div class="card mb-4">
                    <h5 class="card-header">ë‚˜ì˜ ê³„ì • ì •ë³´</h5>
                    <!-- Account -->
                    <form id="frmMypage" name="frm" action="/mypage/mypage" method="post" enctype="multipart/form-data" onsubmit="checkForm(this)">
                      <input type="hidden" id="temFileName" name="temFileName" th:value="${session.memberDTO.fileName != null ? session.memberDTO.fileName : ''}" />
                      <input type="hidden" name="userState" id="userState" value="Y">
                    <div class="card-body">
                      <div class="d-flex align-items-start align-items-sm-center gap-4">
                        <img th:src="${session.memberDTO.fileName != null ? '/upload/' + session.memberDTO.fileName : '/assets/img/image/images2.jpeg'}" alt="user-avatar" class="d-block rounded" height="100" width="100" id="uploadedAvatar" />
                        <div class="button-wrapper">
                          <label for="upload" class="btn btn-primary me-2 mb-4" tabindex="0">
                            <span class="d-none d-sm-block">ì‚¬ì§„ ì˜¬ë¦¬ê¸°</span>
                            <i class="bx bx-upload d-block d-sm-none"></i>
                            <input type="file" id="upload" name="file" class="account-file-input" hidden accept="image/png, image/jpeg" multiple/>
                          </label>
                          <button type="button" id="reset_button" class="btn btn-outline-secondary account-image-reset mb-4">
                            <i class="bx bx-reset d-block d-sm-none"></i>
                            <span class="d-none d-sm-block">ì´ˆê¸°í™”</span>
                          </button>
                          <p class="text-muted mb-0" >800Kì‚¬ì´ì¦ˆì˜ JPG, GIF ë˜ëŠ” PNGë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                        </div>
                      </div>
                    </div>
                    <hr class="my-0" />
                    <div class="card-body">

                        <div class="row">
                          <div class="mb-3 col-md-6">
                            <label for="userId" class="form-label">ID</label>
                            <input data-name="ì•„ì´ë””" class="form-control" type="text" name="userId" id="userId" th:value="${session.memberDTO.userId}" readonly/>
                          </div>
                          <div class="mb-3 col-md-6">
                            <label for="name" class="form-label">ì´ë¦„</label>
                            <input data-name="ì´ë¦„" class="form-control" type="text" id="name" name="name" th:value="${session.memberDTO.name}" readonly/>
                          </div>
                          <div class="mb-3 col-md-6 form-password-toggle">
                            <label class="form-label" for="pwd">ë¹„ë°€ë²ˆí˜¸</label>
                            <div class="input-group input-group-merge">
                              <input data-name="ë¹„ë°€ë²ˆí˜¸" type="password" id="pwd" class="form-control" name="pwd" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="password" />
                              <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                            </div>
                          </div>
                          <div class="mb-3 col-md-6 form-password-toggle">
                            <label class="form-label" for="confirm_pwd">ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥</label>
                            <div class="input-group input-group-merge">
                              <input data-name="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" type="password" id="confirm_pwd" class="form-control" name="confirm_pwd" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="password" />
                              <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>

                            </div>

                          </div>
                          <div class="mb-3 col-md-6">
                            <label for="birthday" class="form-label">ìƒë…„ì›”ì¼</label>
                            <input data-name="ìƒë…„ì›”ì¼" type="date" class="form-control"  id="birthday"  name="birthday" th:value="${session.memberDTO.birthday}" readonly/>
                          </div>
                          <div class="mb-3 col-md-6">
                            <div class="row">
                              <div class="col-lg-8 col-sm-9 pe-lg-1">
                                <label for="email" class="form-label">ì´ë©”ì¼</label>
                                <input data-name="ì´ë©”ì¼" type="text" class="form-control" id="email" name ="email" th:value="${session.memberDTO.email}" placeholder="abc@email.com" readonly/>
                                <input type="hidden" id="authEmail" name="authEmail" value="true">
                              </div>
                              <div class="col-lg-4 col-sm-3 align-content-end ps-lg-1">
                                <button type="button" class="form-control btn btn-outline-primary" id="emailCheck" name="emailCheck">ë‹¤ì‹œì…ë ¥</button>
                              </div>
                            </div>
                          </div>
                          <div class="mb-3 col-md-6">
                            <label for="phoneNumber" class="form-label">ì „í™”ë²ˆí˜¸</label>
                            <div class="input-group">
                              <!-- Phone Number Prefix -->
                              <input data-name="ì „í™”ë²ˆí˜¸" class="form-control" type="text" id="phoneNumber" name="phoneNumber" th:value="${#strings.substring(session.memberDTO.phoneNumber, 0, 3)}" placeholder="010" style="width: 80px;" maxlength="3"/>
                              <!-- Separator -->
                              <span class="input-group-text">-</span>
                              <!-- Phone Number Middle -->
                              <input data-name="ì „í™”ë²ˆí˜¸" class="form-control" type="text" id="phoneNumber2" name="phoneNumber" th:value="${#strings.substring(session.memberDTO.phoneNumber, 3, #strings.length(session.memberDTO.phoneNumber)-4)}" placeholder="1234" style="width: 100px;" maxlength="4" />
                              <!-- Separator -->
                              <span class="input-group-text">-</span>
                              <!-- Phone Number Suffix -->
                              <input data-name="ì „í™”ë²ˆí˜¸" class="form-control" type="text" id="phoneNumber3" name="phoneNumber" th:value="${#strings.substring(session.memberDTO.phoneNumber, #strings.length(session.memberDTO.phoneNumber)-4, #strings.length(session.memberDTO.phoneNumber))}" placeholder="5678" style="width: 100px;" maxlength="4"/>
                            </div>
                          </div>
                          <div class="mb-3 col-md-6">
                            <div class="row">
                              <div class="col-lg-8 col-sm-8 pe-lg-1 px-sm-2">
                                <label for="zipcode" class="form-label">ìš°í¸ë²ˆí˜¸</label>
                                <input data-name="ìš°í¸ë²ˆí˜¸" type="text" class="form-control bg-white" id="zipCode" name="zipCode" placeholder="ìš°í¸ë²ˆí˜¸" readonly th:value="${session.memberDTO.zipCode}"/>
                              </div>
                              <div class="col-lg-4 col-sm-4 align-content-end ps-lg-1">
                                <button type="button" class="form-control btn btn-outline-primary" id="zipCodeBtn" name="zipCodeBtn">ìš°í¸ë²ˆí˜¸</button>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="row justify-content-end">
                          <div class="mb-3 col-md-6 ">
                            <label for="addr1" class="form-label">ì£¼ì†Œ</label>
                            <input data-name="ì£¼ì†Œ" class="form-control bg-white" type="text" id="addr1" name="addr1" value="" placeholder="ì£¼ì†Œ" th:value="${session.memberDTO.addr1}" readonly/>
                            </div>
                        </div>
                        <div class="row justify-content-end">
                          <div class="mb-3 col-md-6 ">
                            <label for="addr2" class="form-label">ìƒì„¸ì£¼ì†Œ</label>
                            <input data-name="ìƒì„¸ì£¼ì†Œ" class="form-control" type="text" id="addr2" name="addr2" value="" placeholder="ìƒì„¸ì£¼ì†Œ" th:value="${session.memberDTO.addr2}"/>
                          </div>
                        </div>
                        <div class="mt-2">
                          <button type="submit"  id="submit_button" class="btn btn-primary me-2">ìˆ˜ì •í•˜ê¸°</button>
                        </div>

                    </div>
                    <!-- /Account -->
                    </form>
                  </div>


                  <div class="card">
                    <h5 class="card-header">íšŒì› íƒˆí‡´</h5>
                    <div class="card-body">
                      <div class="mb-3 col-12 mb-0">
                        <div class="alert alert-warning">
                          <h6 class="alert-heading fw-bold mb-1">ì •ë§ë¡œ íƒˆí‡´ í•˜ì‹œëŠ”ê±´ê°€ìš”?ğŸ¥º</h6>
                          <p class="mb-0">íšŒì› íƒˆí‡´ë¥¼ í•˜ì‹œë©´ ì‚¬ìš©í•˜ì…¨ë˜ ì •ë³´ëŠ” ëª¨ë‘ ì‚¬ë¼ì§€ê³ , ë™ì¼ ì•„ì´ë””ë¡œëŠ” ì¬ ê°€ì…ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.<br/>ì‹ ì¤‘íˆ í™•ì¸í•´ì£¼ì„¸ìš”!</p>
                        </div>
                      </div>
                      <form id="formAccountDeactivation" onsubmit="return false">
                        <div class="form-check mb-3">
                          <input class="form-check-input" type="checkbox" name="accountActivation" id="accountActivation"/>
                          <label class="form-check-label" for="accountActivation">íšŒì› íƒˆí‡´ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
                        </div>
                        <button type="submit" id="delete_button" class="btn btn-danger deactivate-account">íšŒì› íƒˆí‡´í•˜ê¸°</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- / Content -->
            <div class="content-backdrop fade"></div>

          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>
      </div>
    </section>
      <div id="divForToast"></div>
    </th:block>
    <!-- build:js assets/vendor/js/core.js -->
    <th:block layout:fragment="script">
<!--    <script src="/assets/vendor/libs/popper/popper.js"></script>-->
<!--    <script src="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>-->
<!--    <script src="/assets/vendor/js/menu.js"></script>-->
    <script src="/assets/vendor/js/bootstrap.js"></script>
    <script src="/assets/js/main.js"></script>
    <!-- Page JS -->
    <script src="/assets/js/pages-account-settings-account.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <script src="/assets/js/validation.js"></script>
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script>
      let zipcode = document.getElementById("zipCode");
      let zipcodeBtn = document.getElementById("zipCodeBtn");
      let addr1 = document.getElementById("addr1");

      zipcodeBtn.addEventListener("click", ()=> {
      zipCode(zipcode, addr1);
      });

      //ì´ë©”ì¼ ì¤‘ë³µê²€ì‚¬
      let emailCheckButton = document.querySelector("#emailCheck");
      emailCheckButton.addEventListener("click", function(e) {
        e.preventDefault();
        let emailInput = document.querySelector("#email");
        let email = emailInput.value;
        if (emailCheckButton.textContent === "ì¤‘ë³µì²´í¬") {
          if(nullCheck($(emailInput))) {
            // AJAX í†µì‹ 
            $.ajax({
              url: '/member/emailduplecheck',
              type: 'GET',
              contentType: 'application/x-www-form-urlencoded',
              dataType: 'json',
              data: {email: email},

              success: function (response) {
                if (response.success) {
                  const confirm_msg = "ì´ ì´ë©”ì¼ì€ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.\nì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
                  if (confirm(confirm_msg)) {
                    emailInput.value = email;
                    emailInput.readOnly = true;
                    $('#authEmail').val("true");
                    emailCheckButton.textContent = "ë‹¤ì‹œì…ë ¥";
                  }
                } else {
                  alert(response.message);
                }
              },
              error: function () {
                alert("ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
              }
            });
          } else {
            showToast("ê³µë€ì€ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          }
        } else if (emailCheckButton.textContent === "ë‹¤ì‹œì…ë ¥") {
          // ë‹¤ì‹œì…ë ¥ ë¡œì§
          emailInput.readOnly = false;
          emailInput.value = '';
          $('#authEmail').val("false");
          emailCheckButton.textContent = "ì¤‘ë³µì²´í¬";
        }
      });

      //íŒŒì¼ì—…ë¡œë“œ
      document.getElementById('upload').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            document.getElementById('uploadedAvatar').src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      document.addEventListener("DOMContentLoaded", function() {
        // ì½˜ì†”ì— ë¡œê·¸ ì¶”ê°€
        console.log("DOM fully loaded and parsed");

        // ì´ë¯¸ì§€ ë¦¬ì…‹
        document.getElementById("reset_button").addEventListener("click", function() {
          // ì½˜ì†”ì— ë¡œê·¸ ì¶”ê°€
          console.log("Reset button clicked");

          // 'upload' input ìš”ì†Œ ì„ íƒ
          const uploadInput = document.getElementById("upload");
          // input ìš”ì†Œì˜ ê°’ì„ ì´ˆê¸°í™”
          uploadInput.value = "";

          // 'uploadedAvatar' idë¥¼ ê°€ì§„ img ìš”ì†Œ ì„ íƒ
          const uploadedAvatar = document.getElementById("uploadedAvatar");
          // img ìš”ì†Œì˜ src ì†ì„±ì„ ê¸°ë³¸ ì´ë¯¸ì§€ ê²½ë¡œë¡œ ë³€ê²½
          uploadedAvatar.src = '/assets/img/image/images2.jpeg';
          // 'temFileName' idë¥¼ ê°€ì§„ input ìš”ì†Œ ì„ íƒ
          const temFileNameInput = document.getElementById("temFileName");
          // input ìš”ì†Œì˜ ê°’ì„ ë¹ˆ ë¬¸ìì—´ë¡œ ë³€ê²½
          temFileNameInput.value = "";

          // ì½˜ì†”ì— ë¡œê·¸ ì¶”ê°€
          console.log("Image source reset to default");
        });
      });

      const delete_button = document.querySelector("#delete_button");
      delete_button.addEventListener("click",function (e){
        e.preventDefault();
        const accountActivation = document.querySelector("#accountActivation");

        if(!accountActivation.checked){
          alert("í•„ìˆ˜ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.");
          return false;
        }

        const confirm_msg = "ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
        if(confirm(confirm_msg)){
          alert("íƒˆí‡´ë˜ì—ˆìŠµë‹ˆë‹¤.")
          location.href='/mypage/delete';

        }

      });

    </script>






    </th:block>
</html>
