<!DOCTYPE html>
<html lang="en" class="light-style layout-navbar-fixed layout-wide "
      data-theme="theme-default" data-assets-path="/assets/"
      data-template="front-pages"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/common/common.html}">
<!--Page CSS -->
  <th:block layout:fragment="topScript">
  <link rel="stylesheet" href="/assets/vendor/css/pages/wizard-ex-checkout.css" />
  <script src="/assets/vendor/js/template-customizer.js"></script>

  </th:block>


<th:block layout:fragment="content">
<!-- Sections:Start -->

<section class="section-py bg-body">
  <div class="container">
    <form id="wizard-checkout-form" class="card p-5" onSubmit="return false">
      <!-- Cart -->
      <div id="checkout-cart" class="content">
        <div class="row">
          <!-- Cart left -->
          <div class="col-xl-12 mb-3 mb-xl-0">
            <!-- Shopping bag -->
            <h5><strong class="text-primary" th:text="${totalCnt}"></strong> 개의 강의</h5>
            <div class="d-flex align-items-center m-0">
              <div class="form-check form-check-primary col-6">
                <input class="form-check-input" type="checkbox" id="checkAll" />
                <label class="form-check-label" for="checkAll">&nbsp; 전체 선택</label>
              </div>
              <div class="col-6 row justify-content-end">
                <button type="button" class="btn btn-label-danger col-lg-3 col-sm-12 m-0 my-3" onclick="removeCarts()">선택 강의 삭제</button>
              </div>
            </div>
            <hr class="mt-1">
            <ul class="list-group mb-3">
              <th:block th:if="${cartDTOList != null and cartDTOList.size() > 0}">
              <li class="list-group-item p-4" th:each="dto, status : ${cartDTOList}" th:if="${dto.lectureDTO != null}">
                  <div class="d-flex gap-3">
                    <div class="form-check form-check-primary d-flex align-items-center">
                      <label class="form-check-label" for="customCheck"></label>
                      <input class="form-check-input selectCheck" type="checkbox" id="customCheck" th:data-cartidx="${dto.cartIdx}" th:value="${dto.lectureIdx}" name="lectureIdx"/>
                    </div>
                    <div class="flex-shrink-0 d-flex align-items-center">
                      <img th:src="${dto.lectureDTO != null and dto.lectureDTO.thumbnailImgFile != null} ? '/upload/'+${dto.lectureDTO.thumbnailImgFile} : '/assets/img/default.png'" alt="강의 썸네일" class="w-px-100">
                    </div>
                    <div class="flex-grow-1">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <p class="me-3 mb-0"><a th:href="'/lecture/view?lectureIdx='+${dto.lectureIdx}" class="text-body" th:text="${dto.lectureDTO.title}">강의 명</a></p>
                          <div class="text-muted mb-2 d-flex flex-wrap"><span class="me-1"><a th:href="'/lecture/view?lectureIdx='+${dto.lectureIdx}" th:text="${dto.lectureDTO.teacherName}">누구누구</a></span> 선생님</div>
                        </div>
                        <div class="col-md-4">
                          <div class="text-md-end">
                            <button type="button" class="btn-close btn-pinned" aria-label="Close" th:data-cartidx="${dto.cartIdx}" onclick="removeCart(this)"></button>
                            <div class="my-2 my-md-4 mb-md-5"><span class="text-primary" th:text="${dto.lectureDTO.price}">39,900&#8361;</span></div>
                            <!--                          <button type="button" class="btn btn-sm btn-label-primary mt-md-3">찜하기</button>-->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
              </li>
              </th:block>
              <th:block th:unless="${cartDTOList != null and cartDTOList.size() > 0}">
                <li class="list-group-item p-4">
                  <p>장바구니 내역이 없습니다.</p>
                </li>
              </th:block>
            </ul>
            <!-- Wishlist -->
            <div class="list-group">
              <a href="/lecture/list" class="list-group-item d-flex justify-content-between">
                <span>강의 더 둘러보기🏃🏻‍♀️</span>
                <i class="bx bx-sm bx-chevron-right scaleX-n1-rtl"></i>
              </a>
            </div>
            <div class="list-group">
              <div class="row m-0 my-3 justify-content-center">
              <button type="button" class="btn btn-label-primary col-lg-6 col-sm-12 m-0 my-3" onclick="goToPayment()">선택 강의 결제</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</section>

</th:block>


<th:block layout:fragment="script">
  <script src="/assets/vendor/libs/popper/popper.js"></script>

  <!-- Vendors JS -->
  <script src="/assets/vendor/libs/jquery/jquery.js"></script>
  <script>
    //전체 선택
    const checkAll = document.getElementById('checkAll');
    checkAll.addEventListener('change', () => {
      let checkYN = checkAll.checked;
      let selectChecks = document.querySelectorAll('.selectCheck');
      if (checkYN) {
        for (let select of selectChecks) {
          select.checked = true;
        }
      } else {
        for (let select of selectChecks) {
          select.checked = false;
        }
      }
    })
    function removeCart(element) {
      removePOST(element.dataset.cartidx);
    }

    function removeCarts() {
      let idxes = document.querySelectorAll('.selectCheck:checked').values();
      if(idxes.length > 0) {
        let idxesArr = [];
        for(let idx of idxes) {
          idxesArr.push(idx.dataset.cartidx);
        }
        removePOST(idxesArr);
      } else {
        alert("선택된 강의가 없습니다.")
      }
    }

    function removePOST(strOrArr) {
      let formEl = document.createElement('form');
      formEl.action = '/mypage/deleteCart';
      formEl.method = 'post';
      let inputEl;
      if(typeof strOrArr.valueOf() == "string") {
        inputEl = document.createElement('input');
        inputEl.type = 'hidden';
        inputEl.name = 'cartIdx';
        inputEl.value = strOrArr;
        formEl.append(inputEl);
      } else {
        for(let str of strOrArr) {
          inputEl = document.createElement('input');
          inputEl.type = 'hidden';
          inputEl.name = 'cartIdx';
          inputEl.value = str;
          formEl.append(inputEl);
        }
      }
      document.body.append(formEl);
      formEl.submit();
    }

    //결제 페이지 이동
    function goToPayment() {
      let lectureIdxArr = [];
      let lectureIdxEl = document.querySelectorAll('input[name=lectureIdx]:checked');
      if(lectureIdxEl.length > 0) {
        for (let idxEl of lectureIdxEl) {
          lectureIdxArr.push(idxEl.value);
        }
        let lectureIdx = lectureIdxArr.toString();
        location.href = "/payment/payment?lectureIdx="+lectureIdx;
      } else {
        alert("선택된 강의가 없습니다.")
      }
    }
  </script>
</th:block>


</html>

<!-- beautify ignore:end -->

